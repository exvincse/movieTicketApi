import{a as ee}from"./chunk-DPHAL4LE.js";import{a as W}from"./chunk-XTBM2PFI.js";import"./chunk-22DMWHJU.js";import{a as Y}from"./chunk-I4Z6E5RZ.js";import{b as O,c as u,d as H,e as j,h as U,j as z,o as G,p as q,q as L}from"./chunk-3LHWI2W3.js";import{a as M}from"./chunk-IX7WFBWE.js";import{a as x}from"./chunk-OTP24YHY.js";import{v as D}from"./chunk-2F6OI5QL.js";import{a as X}from"./chunk-AN255T3T.js";import{a as $,b as J,e as K,h as Q}from"./chunk-FBP2EEXM.js";import{g as T,l as P}from"./chunk-Q7SBYYKA.js";import{a as Z}from"./chunk-AN7I7KN4.js";import{c as N}from"./chunk-7ABVTXG4.js";import"./chunk-4QTMHVTB.js";import{$a as o,Ab as f,Ac as I,Bb as c,Ec as V,Jb as s,Rb as B,Tb as b,ab as l,ma as w,nb as d,q as F,qb as r,rb as C,sb as a,tb as n,ub as _,vb as S,wa as g,wb as y,xa as v,xc as R,yb as E,yc as A,zc as k}from"./chunk-K24PMR7C.js";import{g as h}from"./chunk-TSRGIXR5.js";var ie=t=>({"background-image":t});function re(t,i){t&1&&(a(0,"div",24),s(1," \u8ACB\u8F38\u5165\u4FE1\u7BB1 "),n())}function oe(t,i){t&1&&(a(0,"div",24),s(1," \u8ACB\u8F38\u5165\u6B63\u78BAemail\u683C\u5F0F "),n())}function ne(t,i){t&1&&(a(0,"div",24),s(1," email\u4E0D\u7B26\u5408gmail\u683C\u5F0F "),n())}function ae(t,i){t&1&&(a(0,"div",24),s(1," \u6B64Email\u5DF2\u8A3B\u518A "),n())}function se(t,i){if(t&1&&(S(0),d(1,re,2,0,"div",23)(2,oe,2,0,"div",23)(3,ne,2,0,"div",23)(4,ae,2,0,"div",23),y()),t&2){let e=c(2);o(),r("ngIf",e.registerForm.controls.email.hasError("required")),o(),r("ngIf",e.registerForm.controls.email.hasError("pattern")),o(),r("ngIf",e.registerForm.controls.email.hasError("emailExistGmail")),o(),r("ngIf",e.registerForm.controls.email.hasError("emailExist"))}}function ce(t,i){t&1&&(a(0,"div",24),s(1," \u8ACB\u8F38\u5165\u5BC6\u78BC "),n())}function le(t,i){t&1&&(a(0,"div",24),s(1," \u5BC6\u78BC\u9577\u5EA6\u9700\u5927\u65BC8\u78BC "),n())}function me(t,i){t&1&&(a(0,"div",24),s(1," \u78BA\u8A8D\u5BC6\u78BC\u4E0D\u4E00\u81F4 "),n())}function pe(t,i){if(t&1&&(S(0),d(1,ce,2,0,"div",23)(2,le,2,0,"div",23)(3,me,2,0,"div",23),y()),t&2){let e=c(2);o(),r("ngIf",e.registerForm.controls.password.hasError("required")),o(),r("ngIf",e.registerForm.controls.password.hasError("minlength")),o(),r("ngIf",e.registerForm.controls.password.hasError("passwordNotMatch"))}}function de(t,i){t&1&&(a(0,"div",24),s(1," \u8ACB\u8F38\u5165\u5BC6\u78BC "),n())}function ue(t,i){t&1&&(a(0,"div",24),s(1," \u5BC6\u78BC\u9577\u5EA6\u9700\u5927\u65BC8\u78BC "),n())}function _e(t,i){t&1&&(a(0,"div",24),s(1," \u78BA\u8A8D\u5BC6\u78BC\u4E0D\u4E00\u81F4 "),n())}function ge(t,i){if(t&1&&(S(0),d(1,de,2,0,"div",23)(2,ue,2,0,"div",23)(3,_e,2,0,"div",23),y()),t&2){let e=c(2);o(),r("ngIf",e.registerForm.controls.checkPassword.hasError("required")),o(),r("ngIf",e.registerForm.controls.checkPassword.hasError("minlength")),o(),r("ngIf",e.registerForm.controls.checkPassword.hasError("passwordNotMatch"))}}function ve(t,i){if(t&1){let e=E();a(0,"div")(1,"div",6)(2,"div",7)(3,"div",8),s(4,"\u7ACB\u5373\u8A3B\u518A"),n()(),a(5,"div",9)(6,"div",10)(7,"div",11)(8,"div",12),_(9,"input",13),n(),d(10,se,5,4,"ng-container",14),n(),a(11,"div",11)(12,"div",12)(13,"div",15),_(14,"input",16),a(15,"a",17),f("click",function(){g(e);let p=c();return v(p.toggleEye())}),_(16,"fa-icon",18),n()()(),d(17,pe,4,3,"ng-container",14),n(),a(18,"div",11)(19,"div",12)(20,"div",15),_(21,"input",19),a(22,"a",17),f("click",function(){g(e);let p=c();return v(p.toggleCheckEye())}),_(23,"fa-icon",18),n()()(),d(24,ge,4,3,"ng-container",14),n()(),a(25,"div",20)(26,"div",21)(27,"a",22),f("click",function(){g(e);let p=c();return v(p.registerEmail())}),s(28," \u8A3B\u518A "),n()()()()()()}if(t&2){let e=c();o(6),r("formGroup",e.registerForm),o(3),C("is-error",e.registerForm.controls.email.invalid&&e.registerForm.controls.email.dirty),o(),r("ngIf",e.registerForm.controls.email.dirty),o(4),C("is-error",e.registerForm.controls.password.invalid&&e.registerForm.controls.password.dirty),r("type",e.isHiddenEye?"password":"text"),o(2),r("icon",e.isHiddenEye?e.faEyeSlash:e.faEye)("size","lg"),o(),r("ngIf",e.registerForm.controls.password.dirty),o(4),C("is-error",e.registerForm.controls.checkPassword.invalid&&e.registerForm.controls.checkPassword.dirty),r("type",e.isHiddenCheckEye?"password":"text"),o(2),r("icon",e.isHiddenCheckEye?e.faEyeSlash:e.faEye)("size","lg"),o(),r("ngIf",e.registerForm.controls.checkPassword.dirty)}}function fe(t,i){if(t&1){let e=E();a(0,"app-otp-valid",25),f("emitValidOtp",function(){g(e);let p=c();return v(p.emitValidOtp())}),n()}if(t&2){let e=c();r("otpEmail",e.otpEmail)}}var te=class t{constructor(i,e,m,p,Ce,Se,ye,he){this.fb=i;this.formValidatorService=e;this.router=m;this.userRepositoryService=p;this.tmdbRepositoryService=Ce;this.userStoreService=Se;this.cookieService=ye;this.sweetAlertService=he;this.registerForm=this.fb.group({email:["",{validators:[u.required,u.pattern("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$")],asyncValidators:[this.formValidatorService.emailValidator()],updateOn:"blur"}],password:["",[u.required,u.minLength(8)]],checkPassword:["",[u.required,u.minLength(8)]]},{validators:this.formValidatorService.passwordMatchValidator()})}registerForm;currentStep="register";faEye=Q;faEyeSlash=K;isHiddenEye=!0;isHiddenCheckEye=!0;bgPic="";ngOnInit(){return h(this,null,function*(){let i=yield this.getMovieDetail();this.bgPic=i.backdrop_path})}get otpEmail(){return this.registerForm.get("email")?.value}toggleEye(){this.isHiddenEye=!this.isHiddenEye}toggleCheckEye(){this.isHiddenCheckEye=!this.isHiddenCheckEye}registerEmail(){if(this.registerForm.valid===!0){let i=this.registerForm.getRawValue();this.userRepositoryService.postSendMail({email:i.email}).subscribe(e=>{e.result===!0&&(this.currentStep="otp")})}}emitValidOtp(){let i={email:this.registerForm.get("email")?.value,password:this.registerForm.get("password")?.value};this.userRepositoryService.postRegisterAccount(i).subscribe(e=>{e.result.accessToken?this.sweetAlertService.open(x,{icon:"success",data:{text:"\u8A3B\u518A\u6210\u529F"}}).instance.afterClose.subscribe(()=>{this.cookieService.set("accessToken",e.result.accessToken,60),this.userStoreService.setUserIsLogin(!0),this.userRepositoryService.getUserProfile(),this.router.navigate(["/"])}):this.sweetAlertService.open(x,{icon:"error",data:{text:"\u8A3B\u518A\u5931\u6557"}})})}getMovieDetail(){return h(this,null,function*(){let i={language:"zh-TW"};return yield F(this.tmdbRepositoryService.getMovieDetail("1104845",i))})}static \u0275fac=function(e){return new(e||t)(l(G),l(W),l(T),l(M),l(X),l(D),l(Y),l(N))};static \u0275cmp=w({type:t,selectors:[["app-register"]],standalone:!0,features:[B],decls:6,vars:6,consts:[[1,"l-login","l-login--register",3,"ngStyle"],[1,"l-login__content"],[1,"l-login__item"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"otpEmail","emitValidOtp",4,"ngSwitchCase"],[1,"l-form"],[1,"l-form__title","l-form__title--login"],[1,"u-font-lg","u-tac"],[1,"l-form__content"],[1,"c-form","c-form--column",3,"formGroup"],[1,"c-form__item","c-form__item--column"],[1,"c-form__text"],["type","text","formControlName","email","placeholder","\u8ACB\u8F38\u5165\u4FE1\u7BB1",1,"o-inputbox","o-inputbox--full"],[4,"ngIf"],[1,"c-login__input"],["formControlName","password","placeholder","\u8ACB\u8F38\u5165\u5BC6\u78BC",1,"o-inputbox","o-inputbox--full","o-inputbox--icon",3,"type"],["href","#","appStopPropagation","",1,"c-login__eye",3,"click"],[1,"u-font-gy",3,"icon","size"],["formControlName","checkPassword","placeholder","\u78BA\u8A8D\u5BC6\u78BC",1,"o-inputbox","o-inputbox--full","o-inputbox--icon",3,"type"],[1,"l-btn","l-btn--center","u-gapB-sm"],[1,"l-btn__item","l-btn__item--full"],["href","#","appStopPropagation","",1,"c-btn",3,"click"],["class","c-form__error",4,"ngIf"],[1,"c-form__error"],[3,"emitValidOtp","otpEmail"]],template:function(e,m){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),d(4,ve,29,16,"div",4)(5,fe,1,1,"app-otp-valid",5),n()()()()),e&2&&(r("ngStyle",b(4,ie,"url(https://image.tmdb.org/t/p/original"+m.bgPic+")")),o(3),r("ngSwitch",m.currentStep),o(),r("ngSwitchCase","register"),o(),r("ngSwitchCase","otp"))},dependencies:[V,R,I,A,k,q,O,H,j,L,U,z,P,J,$,Z,ee]})};export{te as RegisterComponent};
