import{a as me}from"./chunk-4FLAYDXM.js";import{a as de}from"./chunk-H67EF6UW.js";import{a as ge}from"./chunk-RRIXWZOK.js";import{a as pe}from"./chunk-QXZLALXF.js";import{a as Ce}from"./chunk-22DMWHJU.js";import{d as te,f as ie,k as ne,l as ae,m as oe,p as re}from"./chunk-3LHWI2W3.js";import{a as $}from"./chunk-OTP24YHY.js";import{v as Z}from"./chunk-2F6OI5QL.js";import{a as ue}from"./chunk-AN255T3T.js";import{a as ce,b as se,i as le}from"./chunk-FBP2EEXM.js";import{e as X}from"./chunk-Q7SBYYKA.js";import{a as O}from"./chunk-AN7I7KN4.js";import{c as ee}from"./chunk-7ABVTXG4.js";import"./chunk-4QTMHVTB.js";import{$a as s,Ab as x,Ac as K,Bb as d,Da as j,Dc as Q,Ec as L,Jb as c,Kb as v,Lb as C,Nb as U,Ob as z,Pb as G,Rb as M,Tb as H,Ub as W,Wb as q,Ya as B,ab as y,ma as F,nb as g,q as R,qb as l,rb as V,sb as i,tb as n,ub as S,vb as I,vc as J,wa as h,wb as w,wc as A,xa as k,xc as Y,yb as T}from"./chunk-K24PMR7C.js";import{a as E,b as D,f as ve,g as P}from"./chunk-TSRGIXR5.js";var b=ve(Ce());function xe(r,t){if(r&1&&(i(0,"span",17),c(1),n()),r&2){let e=d().$implicit;s(),C(" ",e.column," ")}}function be(r,t){if(r&1&&(i(0,"span",17),c(1),n()),r&2){let e=d().$implicit;s(),C(" ",e.column," ")}}function Te(r,t){if(r&1){let e=T();I(0),g(1,xe,2,1,"span",15),i(2,"a",16),x("click",function(){let o=h(e).index,m=d();return k(m.changeSeat(o))}),c(3),n(),g(4,be,2,1,"span",15),w()}if(r&2){let e=t.$implicit;s(),l("ngIf",e.state.isFirstSeat===!0),s(),V("is-hidden",e.seat===null)("is-noSelect",e.state.disableSeat===!0)("is-select",e.state.isSelect),s(),C(" ",e.seat," "),s(),l("ngIf",e.state.isLastSeat===!0)}}var N=class r{ticketCategory=[];disableSeatSeat=[];submitTicket=new j;seatChart=[];spcialSeat=[];selectSeat=[];ngOnInit(){this.initSeatNo()}get seatCount(){return this.ticketCategory.map(t=>t.count).reduce((t,e)=>t+e,0)}initSeatNo(){let e=17;this.seatChart=[],this.spcialSeat=[{column:1,seat:5,insertCount:2},{column:1,seat:14,insertCount:2},{column:2,seat:5,insertCount:2},{column:2,seat:14,insertCount:2},{column:3,seat:5,insertCount:2},{column:3,seat:14,insertCount:2},{column:4,seat:5,insertCount:2},{column:4,seat:14,insertCount:2},{column:5,seat:5,insertCount:2},{column:5,seat:14,insertCount:2},{column:6,seat:5,insertCount:2},{column:6,seat:14,insertCount:2},{column:7,seat:5,insertCount:2},{column:7,seat:14,insertCount:2},{column:8,seat:5,insertCount:2},{column:8,seat:14,insertCount:2},{column:9,seat:5,insertCount:2},{column:9,seat:14,insertCount:2}];for(let a=1;a<=10;a+=1){a===10&&(e=21);for(let o=1;o<=e;o+=1){let m=!1;this.disableSeatSeat.find(u=>u.column===a&&u.seat===o)!==void 0&&(m=!0);let p=this.spcialSeat.find(u=>u.column===a&&u.seat===o);if(p!==void 0)for(let u=1;u<=p.insertCount;u+=1)this.seatChart.push({column:a,seat:null,state:{disableSeat:!1,isSelect:!1,isFirstSeat:o===1,isLastSeat:o===e}});this.seatChart.push({column:a,seat:o,state:{disableSeat:m,isSelect:!1,isFirstSeat:o===1,isLastSeat:o===e}})}}}changeSeat(t){let e=this.seatChart[t];if(e.seat!==null)if(e.state.isSelect===!0){this.seatChart[t].state.isSelect=!1;let a=this.selectSeat.findIndex(o=>o.column===e.column&&o.seat===e.seat);a!==-1&&this.selectSeat.splice(a,1)}else this.selectSeat.length<this.seatCount&&(this.seatChart[t].state.isSelect=!0,this.selectSeat.push({column:e.column,seat:e.seat}))}submitSeat(){this.selectSeat.length===this.seatCount&&this.submitTicket.emit(this.selectSeat)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-seat-chart"]],inputs:{ticketCategory:"ticketCategory",disableSeatSeat:"disableSeatSeat"},outputs:{submitTicket:"submitTicket"},standalone:!0,features:[M],decls:24,vars:3,consts:[[1,"l-seatChart"],[1,"l-seatChart__wrap"],[1,"l-seatChart__title"],[1,"l-seatChart__icon"],[1,"o-icon","o-icon--green"],[1,"u-font-sm","u-gapT-min"],[1,"o-icon","o-icon--yellow"],[1,"l-seatChart__screen"],[1,"l-seatChart__text"],["href","#","appStopPropagation","",1,"c-seatChart__item","c-seatChart__item--column"],[1,"c-seatChart"],[4,"ngFor","ngForOf"],[1,"l-btn","l-btn--center"],[1,"l-btn__item"],["href","#","appStopPropagation","",1,"c-btn","c-btn--reverseColor",3,"click"],["class","c-seatChart__item c-seatChart__item--column",4,"ngIf"],["href","#","appStopPropagation","",1,"c-seatChart__item",3,"click"],[1,"c-seatChart__item","c-seatChart__item--column"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),S(4,"i",4),i(5,"span",5),c(6,"\u5DF2\u9078\u53D6"),n()(),i(7,"div",3),S(8,"i",6),i(9,"span",5),c(10,"\u7121\u6CD5\u9078\u53D6"),n()()(),i(11,"div",7),c(12," \u9280\u5E55 "),n(),i(13,"div",8)(14,"span",9),c(15," \u6392 "),n(),i(16,"span",9),c(17," \u6392 "),n()(),i(18,"div",10),g(19,Te,5,9,"ng-container",11),n(),i(20,"div",12)(21,"div",13)(22,"a",14),x("click",function(){return a.submitSeat()}),c(23," \u9001\u51FA "),n()()()()()),e&2&&(s(19),l("ngForOf",a.seatChart),s(3),V("is-disabled",a.selectSeat.length<a.seatCount))},dependencies:[L,A,Y,O]})};var ye=r=>({"background-image":r}),Ee=r=>({"is-active":r});function De(r,t){if(r&1&&(i(0,"div",5)(1,"div",15),S(2,"div",16),i(3,"div",17)(4,"div",18)(5,"div",19)(6,"div",20),c(7),n(),i(8,"div",21),c(9),n()(),i(10,"div",22)(11,"div",23)(12,"div",24)(13,"div",25),c(14,"\u7D1A\u5225"),n(),i(15,"div",26),S(16,"img",27),n()(),i(17,"div",24)(18,"div",25),c(19,"\u7247\u9577"),n(),i(20,"div",26),c(21),n()(),i(22,"div",24)(23,"div",25),c(24,"\u4E0A\u6620\u65E5"),n(),i(25,"div",26),c(26),n()(),i(27,"div",24)(28,"div",25),c(29,"\u985E\u578B"),n(),i(30,"div",26),c(31),n()(),i(32,"div",24)(33,"div",25),c(34,"\u6F14\u54E1"),n(),i(35,"div",26),c(36),n()(),i(37,"div",24)(38,"div",25),c(39,"\u5C0E\u6F14"),n(),i(40,"div",26),c(41),n()()()()()()()()),r&2){let e=d();s(2),l("ngStyle",H(9,ye,"url(https://image.tmdb.org/t/p/w342"+e.movieDetail.poster_path+")")),s(5),v(e.movieDetail.title),s(2),v(e.movieDetail.original_title),s(7),l("src","assets/images/icons/rating/"+e.movieDetail.rateImg+".png",B),s(5),C("",e.movieDetail.runtime,"\u5206"),s(5),v(e.movieDetail.release_date),s(5),v(e.movieDetail.genres),s(5),v(e.movieDetail.cast),s(5),v(e.movieDetail.director)}}function Ie(r,t){if(r&1){let e=T();i(0,"swiper-slide",28)(1,"a",29),x("click",function(){let o=h(e).$implicit,m=d();return k(m.selectTicketDate(o))}),c(2),W(3,"date"),n()()}if(r&2){let e=t.$implicit,a=d();l("ngClass",H(5,Ee,a.ticketSelect.date===e)),s(2),C(" ",q(3,2,e,"MM\u6708dd\u65E5")," ")}}function we(r,t){if(r&1){let e=T();i(0,"div",34)(1,"label",35)(2,"input",36),x("change",function(){let o=h(e).$implicit,m=d().$implicit,_=d();return k(_.selectTicketTime(m,o.name))}),n(),i(3,"div",37),c(4),n()()()}if(r&2){let e=t.$implicit,a=d().$implicit,o=d();s(2),l("disabled",e.isDisable)("checked",o.ticketSelect.ticketLanguageCode===a.categoryCode&&o.ticketSelect.time===e.name),s(2),v(e.name)}}function Fe(r,t){if(r&1&&(i(0,"tr")(1,"td",30),c(2),n(),i(3,"td",31)(4,"div",32),g(5,we,5,3,"div",33),n()()()),r&2){let e=t.$implicit,a=d();s(2),v(e.categoryName),s(3),l("ngForOf",a.ticketTime)}}function Me(r,t){if(r&1&&(i(0,"option",48),c(1),n()),r&2){let e=t.$implicit;l("value",e),s(),C(" ",e," ")}}function Ae(r,t){if(r&1){let e=T();i(0,"tr")(1,"td",42),c(2),n(),i(3,"td",43),c(4),n(),i(5,"td",44)(6,"select",45),G("ngModelChange",function(o){let m=h(e).index,_=d(2);return z(_.ticketSelect.ticketCategory[m].count,o)||(_.ticketSelect.ticketCategory[m].count=o),k(o)}),x("ngModelChange",function(o){let m=h(e).index,_=d(2);return k(_.selectTickCategory(o,m))}),g(7,Me,2,2,"option",46),n()(),i(8,"td",47),c(9),n()()}if(r&2){let e=t.$implicit,a=t.index,o=d(2);s(2),v(e.categoryName),s(2),C("$",e.cost,""),s(2),U("ngModel",o.ticketSelect.ticketCategory[a].count),s(),l("ngForOf",o.ticketCount),s(2),C(" $",e.cost*o.ticketSelect.ticketCategory[a].count," ")}}function Ye(r,t){if(r&1){let e=T();i(0,"div",49)(1,"div",50)(2,"a",51),x("click",function(){h(e);let o=d(2);return k(o.selectSeat())}),c(3," \u9078\u53D6\u5EA7\u4F4D "),S(4,"fa-icon",52),n()()()}if(r&2){let e=d(2);s(4),l("icon",e.faGreaterThan)("size","2xs")}}function Le(r,t){if(r&1&&(I(0),i(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),c(5,"\u9078\u53D6\u7968\u7A2E"),n()()()(),i(6,"div",5)(7,"div",38)(8,"table",12)(9,"colgroup"),S(10,"col")(11,"col",39)(12,"col",39)(13,"col",39),n(),i(14,"thead")(15,"tr")(16,"th"),c(17,"\u7968\u7A2E"),n(),i(18,"th",40),c(19,"\u55AE\u50F9"),n(),i(20,"th",40),c(21,"\u6578\u91CF"),n(),i(22,"th",40),c(23,"\u5C0F\u8A08"),n()()(),i(24,"tbody"),g(25,Ae,10,5,"tr",13),n()(),g(26,Ye,5,2,"div",41),n()(),w()),r&2){let e=d();s(25),l("ngForOf",e.ticketCategory),s(),l("ngIf",e.tickCategoryCount>0)}}function Oe(r,t){if(r&1){let e=T();I(0),i(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),c(5,"\u9078\u53D6\u5EA7\u4F4D"),n()()()(),i(6,"div",5)(7,"div",38)(8,"app-seat-chart",53),x("submitTicket",function(o){h(e);let m=d();return k(m.submitTicket(o))}),n()()(),w()}if(r&2){let e=d();s(8),l("ticketCategory",e.ticketSelect.ticketCategory)("disableSeatSeat",e.disableSeatSeat)}}var _e=class r{constructor(t,e,a,o,m,_){this.route=t;this.tmdbRepositoryService=e;this.ticketRepositoryService=a;this.sweetAlertService=o;this.userStoreService=m;this.loaderService=_}movieDetail={id:0,title:"",genres:"",director:"",cast:"",rate:"",rateImg:"",adult:!1,backdrop_path:"",belongs_to_collection:"",budget:0,homepage:"",imdb_id:"",original_language:"",original_title:"",overview:"",popularity:0,poster_path:"",production_companies:[],production_countries:[],release_date:"",revenue:0,runtime:0,spoken_languages:[],status:"",tagline:"",video:!1,vote_average:0,vote_count:0,origin_country:[]};faGreaterThan=le;date=[];ticketCount=new Array(11).fill(0).map((t,e)=>e);ticketSelect={date:(0,b.default)().format("YYYY-MM-DD"),ticketLanguageCode:"",ticketLanguageName:"",time:"",ticketCategory:[]};ticketCategory=[];ticketLanguage=[];ticketTime=[{code:"001",name:"13:10",isDisable:!1},{code:"002",name:"16:10",isDisable:!1},{code:"003",name:"20:10",isDisable:!1},{code:"003",name:"22:10",isDisable:!1}];isHiddenSelectSeat=!0;disableSeatSeat=[];swiperConfig={slidesPerView:"auto",spaceBetween:10,pagination:!1,navigation:{nextEl:".c-dateTab__next",prevEl:".c-dateTab__prev"}};ngOnInit(){this.getMovieDetail(),this.getTickCategory(),this.getTickLanguage(),this.getTickTime(),this.ticketTime.forEach(t=>{let e=(0,b.default)(),a=(0,b.default)(`${this.ticketSelect.date} ${t.name}`,"YYYY-MM-DD HH:mm").subtract(1,"hours");Object.assign(t,{isDisable:e.isAfter(a)})})}getMovieDetail(){return P(this,null,function*(){let t=pe({from:"cn",to:"tw"}),e=this.route.snapshot.params.id,a={language:"zh-TW"},{list:o,credits:m,rate:_}=yield R(this.tmdbRepositoryService.getMovieMergeDetail(e,a)),p=_.results.find(f=>f.iso_3166_1==="US"),u=m.crew.find(f=>f.job==="Director")?.name||"",Se=m.cast.filter(f=>f.order<5).map(f=>f.name).join("\u3001")||"";switch(this.movieDetail=D(E({},o),{genres:t(o.genres.map(f=>f.name).join("\u3001")),director:u,cast:Se,rate:p?p.release_dates[0].certification:"",rateImg:""}),this.movieDetail.rate){case"R":this.movieDetail.rateImg="rating_18";break;case"PG-13":this.movieDetail.rateImg="rating_12";break;case"15":this.movieDetail.rateImg="rating_15";break;default:this.movieDetail.rateImg="rating";break}})}getTickCategory(){this.ticketRepositoryService.getTicketCategory().subscribe(t=>{this.ticketCategory=t.result,this.ticketSelect.ticketCategory=t.result.map(e=>D(E({},e),{count:0}))})}getTickLanguage(){this.ticketRepositoryService.getTicketLanguage().subscribe(t=>{this.ticketLanguage=t.result})}getTickTime(){for(let t=0;t<5;t+=1)this.date.push((0,b.default)().add(t,"d").format("YYYY-MM-DD"))}selectTicketDate(t){this.ticketSelect.date=t,this.ticketSelect.ticketLanguageCode="",this.ticketSelect.ticketLanguageName="",this.ticketSelect.time="",this.isHiddenSelectSeat=!0,this.ticketTime.forEach(e=>{let a=(0,b.default)(),o=(0,b.default)(`${this.ticketSelect.date} ${e.name}`,"YYYY-MM-DD HH:mm").subtract(1,"hours");Object.assign(e,{isDisable:a.isAfter(o)})})}selectTicketTime(t,e){this.ticketSelect.ticketLanguageCode=t.categoryCode,this.ticketSelect.ticketLanguageName=t.categoryName,this.ticketSelect.time=e,this.ticketSelect.ticketCategory=this.ticketSelect.ticketCategory.map(a=>D(E({},a),{count:0}))}get tickCategoryCount(){return this.ticketSelect.ticketCategory.map(t=>t.count).reduce((t,e)=>t+e,0)}selectTickCategory(t,e){this.ticketSelect.ticketCategory[e].count=parseInt(t,10)}submitTicket(t){this.userStoreService.getUserData().subscribe(e=>{if(e!==null&&e.userNo!==0){let a=[],o=0;this.ticketSelect.ticketCategory.filter(p=>p.count>0).forEach(p=>{for(let u=0;u<p.count;u+=1)a.push(D(E({},p),{column:t[o].column,seat:t[o].seat??0})),o+=1});let{cost:m}=a.reduce((p,u)=>({cost:p.cost+u.cost}),{cost:0}),_={movieId:this.movieDetail.id,movieName:this.movieDetail.title,ticketDateTime:(0,b.default)(`${this.ticketSelect.date} ${this.ticketSelect.time}`,"YYYY-MM-DD HH:mm").format("YYYY-MM-DDTHH:mm:ss"),ticketLanguageCode:this.ticketSelect.ticketLanguageCode,ticketLanguageName:this.ticketSelect.ticketLanguageName,ticketCategory:a,totalCost:m};this.ticketRepositoryService.postSealTicket(_).subscribe(p=>{p.result!==!1?(window.location.href=p.result,this.loaderService.startLoadingCount()):this.sweetAlertService.open($,{icon:"error",data:{text:p.message}})})}else this.sweetAlertService.open($,{icon:"error",data:{text:"\u8ACB\u5148\u767B\u5165"}})})}selectSeat(){let t={movieId:this.movieDetail.id,movieTicketDateTime:(0,b.default)(`${this.ticketSelect.date} ${this.ticketSelect.time}`,"YYYY-MM-DD HH:mm").format("YYYY-MM-DDTHH:mm:ss"),ticketLanguageCode:this.ticketSelect.ticketLanguageCode};this.ticketRepositoryService.postSelectSeat(t).subscribe(e=>{this.disableSeatSeat=e.result,this.isHiddenSelectSeat=!1})}static \u0275fac=function(e){return new(e||r)(y(X),y(ue),y(me),y(ee),y(Z),y(de))};static \u0275cmp=F({type:r,selectors:[["app-issue-ticket"]],standalone:!0,features:[M],decls:32,vars:6,consts:[[1,"l-headingBar"],[1,"l-headingBar__wrap"],[1,"l-headingBar__content"],[1,"l-headingBar__title"],["class","l-card",4,"ngIf"],[1,"l-card"],[1,"l-swiper","u-gapH-md"],["appSwiper","","init","false",1,"swiper-container","c-dateTab","c-dateTab--underline",3,"swiperConfig"],["class","c-dateTab__item",3,"ngClass",4,"ngFor","ngForOf"],["href","#","appStopPropagation","",1,"c-dateTab__prev"],["href","#","appStopPropagation","",1,"c-dateTab__next"],[1,"u-gapT-sm","u-gapH-md-t"],[1,"c-table","c-table--card","c-table--underline"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"c-movieCard","c-movieCard--wrap"],[1,"c-movieCard__img","c-movieCard__img--detail",3,"ngStyle"],[1,"c-movieCard__content"],[1,"l-movieDetail"],[1,"l-movieDetail__head"],[1,"l-movieDetail__title"],[1,"l-movieDetail__subTitle"],[1,"l-movieDetail__content"],[1,"c-form","c-form--column"],[1,"c-form__item"],[1,"c-form__label"],[1,"c-form__text"],["width","28","height","28","alt","","srcset","",3,"src"],[1,"c-dateTab__item",3,"ngClass"],["href","#","appStopPropagation","",1,"c-dateTab__link",3,"click"],["data-label","\u8A9E\u8A00"],["data-label","\u6642\u9593"],[1,"l-radio"],["class","l-radio__item",4,"ngFor","ngForOf"],[1,"l-radio__item"],[1,"o-radiobox","o-radiobox--btn","o-radiobox--lg"],["type","radio","name","category",1,"o-radiobox__input",3,"change","disabled","checked"],[1,"o-radiobox__text"],[1,"u-gapH-md-t"],[2,"width","121px"],[1,"is-center"],["class","l-btn l-btn--right",4,"ngIf"],["data-label","\u7968\u7A2E"],["data-label","\u55AE\u50F9",1,"is-center"],["data-label","\u6578\u91CF",1,"is-center"],[1,"o-selectbox",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["data-label","\u5C0F\u8A08",1,"is-center"],[3,"value"],[1,"l-btn","l-btn--right"],[1,"l-btn__item"],["href","#","appStopPropagation","",1,"c-btn","c-btn--reverseColor","c-btn--animate",3,"click"],[3,"icon","size"],[3,"submitTicket","ticketCategory","disableSeatSeat"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),c(4,"\u96FB\u5F71\u7C21\u4ECB"),n()()()(),g(5,De,42,11,"div",4),i(6,"div",0)(7,"div",1)(8,"div",2)(9,"div",3),c(10,"\u7DDA\u4E0A\u8A02\u7968"),n()()()(),i(11,"div",5)(12,"div",6)(13,"swiper-container",7),g(14,Ie,4,7,"swiper-slide",8),n(),S(15,"a",9)(16,"a",10),n(),i(17,"div",11)(18,"table",12)(19,"colgroup"),S(20,"col")(21,"col"),n(),i(22,"thead")(23,"tr")(24,"th"),c(25,"\u8A9E\u8A00"),n(),i(26,"th"),c(27,"\u6642\u9593"),n()()(),i(28,"tbody"),g(29,Fe,6,2,"tr",13),n()()()(),g(30,Le,27,2,"ng-container",14)(31,Oe,9,2,"ng-container",14)),e&2&&(s(5),l("ngIf",a.movieDetail.title),s(8),l("swiperConfig",a.swiperConfig),s(),l("ngForOf",a.date),s(15),l("ngForOf",a.ticketLanguage),s(),l("ngIf",a.ticketSelect.time!==""),s(),l("ngIf",a.isHiddenSelectSeat===!1&&a.tickCategoryCount>0))},dependencies:[L,J,A,Y,K,Q,re,ae,oe,ne,te,ie,ge,se,ce,N,O]})};export{_e as IssueTicketComponent};
