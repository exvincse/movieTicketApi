import{a as y}from"./chunk-I4Z6E5RZ.js";import{b as M,c as d,d as N,e as z,h as V,j as q,o as H,p as O,q as Z}from"./chunk-3LHWI2W3.js";import{a as f}from"./chunk-IUYBZPAI.js";import{a as S}from"./chunk-WWFXL6JD.js";import{t as v}from"./chunk-TDJR5REH.js";import{a as X}from"./chunk-AN255T3T.js";import{a as $,b as J,e as K,h as Q}from"./chunk-MOQSDQEH.js";import{g,h as P,k as D}from"./chunk-KQUYMQJB.js";import{a as W}from"./chunk-AN7I7KN4.js";import{c as _}from"./chunk-AKLULRCC.js";import"./chunk-4QTMHVTB.js";import{$a as l,Ab as k,Ac as U,Bb as I,Ec as G,Jb as c,Rb as T,Sb as B,Tb as L,aa as R,ab as s,fa as p,ma as x,nb as u,q as w,qb as a,rb as F,sb as r,tb as n,ub as m,vb as E,wb as A,xc as j}from"./chunk-K24PMR7C.js";import{g as b}from"./chunk-TSRGIXR5.js";var h=class e{constructor(t,o,i,C,ee){this.userRepositoryService=t;this.cookieService=o;this.userStoreService=i;this.router=C;this.sweetAlertService=ee}clientId="194845046746-ind8shn8n3c52pjiishd4gbelkq379pe.apps.googleusercontent.com";loadGoogleAuth(){google.accounts.id.initialize({client_id:this.clientId,callback:this.handleResponse.bind(this),auto_select:!1});let t=document.getElementById("googleSign");google.accounts.id.renderButton(t,{theme:"outline",size:"large"})}handleResponse(t){let o=t.credential;this.userRepositoryService.postGoogleLogin({googleToken:o}).subscribe(i=>{i.result.accessToken?(this.cookieService.set("accessToken",i.result.accessToken,60),this.userStoreService.setUserIsLogin(!0),this.userRepositoryService.getUserProfile(),this.router.navigate(["/"])):this.sweetAlertService.open(S,{icon:"error",data:{text:"\u767B\u5165\u5931\u6557"}})})}static \u0275fac=function(o){return new(o||e)(p(f),p(y),p(v),p(g),p(_))};static \u0275prov=R({token:e,factory:e.\u0275fac,providedIn:"root"})};var ce=e=>({"background-image":e}),se=()=>["/forgetPassword"],me=()=>["/register"];function pe(e,t){e&1&&(r(0,"div",28),c(1," \u8ACB\u8F38\u5165\u4FE1\u7BB1 "),n())}function ue(e,t){e&1&&(r(0,"div",28),c(1," \u8ACB\u8F38\u5165\u6B63\u78BAemail\u683C\u5F0F "),n())}function de(e,t){if(e&1&&(E(0),u(1,pe,2,0,"div",27)(2,ue,2,0,"div",27),A()),e&2){let o=I();l(),a("ngIf",o.loginForm.controls.email.hasError("required")),l(),a("ngIf",o.loginForm.controls.email.hasError("pattern"))}}function ge(e,t){e&1&&(r(0,"div",28),c(1," \u8ACB\u8F38\u5165\u5BC6\u78BC "),n())}function ve(e,t){e&1&&(r(0,"div",28),c(1," \u5BC6\u78BC\u9577\u5EA6\u9700\u5927\u65BC8\u78BC "),n())}function fe(e,t){if(e&1&&(E(0),u(1,ge,2,0,"div",27)(2,ve,2,0,"div",27),A()),e&2){let o=I();l(),a("ngIf",o.loginForm.controls.password.hasError("required")),l(),a("ngIf",o.loginForm.controls.password.hasError("minlength"))}}var Y=class e{constructor(t,o,i,C,ee,Se,_e,ye){this.fb=t;this.router=o;this.userRepositoryService=i;this.tmdbRepositoryService=C;this.userStoreService=ee;this.cookieService=Se;this.sweetAlertService=_e;this.googleAuthService=ye;this.loginForm=this.fb.group({email:["",[d.required,d.pattern("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$")]],password:["",[d.required,d.minLength(8)]]})}loginForm;faEye=Q;faEyeSlash=K;isHiddenEye=!0;bgPic="";ngOnInit(){return b(this,null,function*(){let t=yield this.getMovieDetail();this.bgPic=t.backdrop_path})}ngAfterViewInit(){this.googleAuthService.loadGoogleAuth()}getMovieDetail(){return b(this,null,function*(){let t={language:"zh-TW"};return yield w(this.tmdbRepositoryService.getMovieDetail("1104845",t))})}toggleEye(){this.isHiddenEye=!this.isHiddenEye}login(){if(this.loginForm.valid===!0){let t=this.loginForm.getRawValue(),o={email:t.email,password:t.password};this.userRepositoryService.postLogin(o).subscribe(i=>{i.result.accessToken?(this.cookieService.set("accessToken",i.result.accessToken,60),this.userStoreService.setUserIsLogin(!0),this.userRepositoryService.getUserProfile(),this.router.navigate(["/"])):this.sweetAlertService.open(S,{icon:"error",data:{text:"\u767B\u5165\u5931\u6557"}})})}}static \u0275fac=function(o){return new(o||e)(s(H),s(g),s(f),s(X),s(v),s(y),s(_),s(h))};static \u0275cmp=x({type:e,selectors:[["app-login"]],standalone:!0,features:[T],decls:40,vars:17,consts:[[1,"l-login",3,"ngStyle"],[1,"l-login__content"],[1,"l-login__item"],[1,"l-form"],[1,"l-form__title","l-form__title--login"],[1,"u-font-lg"],[1,"l-form__content"],[1,"c-form","c-form--column",3,"formGroup"],[1,"c-form__item","c-form__item--column"],[1,"c-form__text"],["type","text","formControlName","email","placeholder","\u8ACB\u8F38\u5165\u4FE1\u7BB1",1,"o-inputbox","o-inputbox--full"],[4,"ngIf"],[1,"c-login__input"],["formControlName","password","placeholder","\u8ACB\u8F38\u5165\u5BC6\u78BC",1,"o-inputbox","o-inputbox--full","o-inputbox--icon",3,"type"],["href","#","appStopPropagation","",1,"c-login__eye",3,"click"],[1,"u-font-gy",3,"icon","size"],[1,"l-btn","l-btn--center","u-gapB-sm"],[1,"l-btn__item","l-btn__item--full"],["href","#","appStopPropagation","",1,"c-btn",3,"click"],[1,"o-link","u-font-min",3,"routerLink"],[1,"l-login__line"],[1,"c-login__line"],[1,"l-login__third"],[1,"l-btn","l-btn--noWrap","l-btn--center","u-gapB-sm"],["id","googleSign",1,"l-btn__item","l-btn__item--center"],[1,"l-login__register"],[1,"o-link",3,"routerLink"],["class","c-form__error",4,"ngIf"],[1,"c-form__error"]],template:function(o,i){o&1&&(r(0,"div",0)(1,"div",1),m(2,"div"),r(3,"div",2)(4,"div",3)(5,"div",4)(6,"span",5),c(7,"\u767B\u5165"),n()(),r(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9),m(12,"input",10),n(),u(13,de,3,2,"ng-container",11),n(),r(14,"div",8)(15,"div",9)(16,"div",12),m(17,"input",13),r(18,"a",14),k("click",function(){return i.toggleEye()}),m(19,"fa-icon",15),n()()(),u(20,fe,3,2,"ng-container",11),n()(),r(21,"div",16)(22,"div",17)(23,"a",18),k("click",function(){return i.login()}),c(24," \u767B\u5165 "),n()()(),r(25,"div")(26,"a",19),c(27," \u5FD8\u8A18\u5BC6\u78BC? "),n()(),r(28,"div",20),m(29,"div",21),r(30,"span"),c(31,"\u6216"),n(),m(32,"div",21),n(),r(33,"div",22)(34,"div",23),m(35,"div",24),n()(),r(36,"div",25),c(37," \u6C92\u6709\u5E33\u865F? "),r(38,"a",26),c(39," \u8A3B\u518A "),n()()()()()()()),o&2&&(a("ngStyle",L(13,ce,"url(https://image.tmdb.org/t/p/original"+i.bgPic+")")),l(9),a("formGroup",i.loginForm),l(3),F("is-error",!i.loginForm.controls.email.valid&&i.loginForm.controls.email.touched),l(),a("ngIf",i.loginForm.controls.email.touched),l(4),F("is-error",!i.loginForm.controls.password.valid&&i.loginForm.controls.password.touched),a("type",i.isHiddenEye?"password":"text"),l(2),a("icon",i.isHiddenEye?i.faEyeSlash:i.faEye)("size","lg"),l(),a("ngIf",i.loginForm.controls.password.touched),l(6),a("routerLink",B(15,se)),l(12),a("routerLink",B(16,me)))},dependencies:[G,j,U,O,M,N,z,Z,V,q,D,P,J,$,W]})};export{Y as LoginComponent};
