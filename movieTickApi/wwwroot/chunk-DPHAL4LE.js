import{b as U,d as H,e as q,h as K,i as z,j as J,n as W,o as X,q as Y}from"./chunk-3LHWI2W3.js";import{a as Q}from"./chunk-IX7WFBWE.js";import{a as j}from"./chunk-OTP24YHY.js";import{a as Z}from"./chunk-AN7I7KN4.js";import{c as L}from"./chunk-7ABVTXG4.js";import{$a as l,A as y,Ab as C,B as F,Bb as s,Da as I,Eb as b,Ec as P,Fb as O,Gb as A,Hb as B,Ib as k,Jb as a,Kb as D,Lb as T,Rb as N,Xb as R,Y as d,ab as f,ma as x,n as h,nb as E,qb as _,sb as r,tb as p,ub as w,vb as S,wa as u,wb as V,wc as M,xa as m,xc as G,yb as v}from"./chunk-K24PMR7C.js";var tt=["otpInput"];function et(n,i){if(n&1){let t=v();r(0,"input",17,1),C("input",function(o){let c=u(t).index,g=s();return m(g.otpInputFocus(o,c))})("keydown",function(o){let c=u(t).index,g=s();return m(g.otpInputBack(o,c))}),p()}if(n&2){let t=i.index;b("formControlName",t)}}function it(n,i){if(n&1&&(S(0),a(1),V()),n&2){let t=s();l(),T(" ",t.second,"\u79D2\u5F8C\u53EF\u91CD\u65B0\u767C\u9001\u9A57\u8B49\u78BC ")}}function ot(n,i){if(n&1){let t=v();r(0,"a",18),C("click",function(){u(t);let o=s();return m(o.resendOtp())}),a(1,"\u91CD\u65B0\u767C\u9001\u9A57\u8B49\u78BC"),p()}}var $=class n{constructor(i,t,e){this.userRepositoryService=i;this.fb=t;this.sweetAlertService=e;this.otpForm=this.fb.group({otp:this.fb.array(new Array(6).fill("").map(()=>[""]))}),this.sendMailCountDown()}otpEmail="";emitValidOtp=new I;otpInput;otpForm;second=60;get otpInputArray(){return this.otpForm.get("otp")}get maskEmail(){return this.otpEmail.replace(/^(.{2})(.{4})(.*@)/,(i,t,e,o)=>[t,"*".repeat(4),o].join(""))}otpInputFocus(i,t){let e=i.target;e.value=e.value.replace(/[^0-9]/g,""),e.value.length===1&&t<this.otpInput.length-1&&this.otpInput.get(t+1)?.nativeElement.focus()}otpInputBack(i,t){let e=i.target;i.key==="Backspace"&&t>0&&e.value===""&&this.otpInput.get(t-1)?.nativeElement.focus()}submitOtp(){let i=this.otpForm.getRawValue(),t={email:this.otpEmail,otp:i.otp.join("")};this.userRepositoryService.postValidOtp(t).pipe(d(e=>{e.result===!1&&this.sweetAlertService.open(j,{icon:"error",data:{text:e.message}})}),y(e=>e.result===!0),d(()=>{this.emitValidOtp.emit(!0),this.otpForm.reset(),this.otpInput.first?.nativeElement.focus()}),F(e=>h(()=>e))).subscribe()}resendOtp(){this.userRepositoryService.postSendMail({email:this.otpEmail}).pipe(y(i=>i.result===!0),d(()=>{this.second=60,this.sendMailCountDown()})).subscribe()}sendMailCountDown(){let i=setInterval(()=>{this.second>0?this.second-=1:clearInterval(i)},1e3)}static \u0275fac=function(t){return new(t||n)(f(Q),f(X),f(L))};static \u0275cmp=x({type:n,selectors:[["app-otp-valid"]],viewQuery:function(t,e){if(t&1&&O(tt,5),t&2){let o;A(o=B())&&(e.otpInput=o)}},inputs:{otpEmail:"otpEmail"},outputs:{emitValidOtp:"emitValidOtp"},standalone:!0,features:[N],decls:23,vars:5,consts:[["sendOtp",""],["otpInput",""],[1,"l-form"],[1,"l-form__title"],[1,"u-font-lg","u-font-primary","u-bold","u-tac"],[1,"l-form__content",3,"formGroup"],[1,"l-otp"],[1,"l-otp__email"],[1,"u-bold","u-font-primary"],[1,"l-otp__title"],["formArrayName","otp",1,"l-otp__code"],["type","tel","class","o-inputbox o-inputbox--otp","autocomplete","off","maxlength","1",3,"formControlName","input","keydown",4,"ngFor","ngForOf"],[1,"l-btn","l-btn--center","u-gapB-sm"],[1,"l-btn__item","l-btn__item--full"],["href","#","appStopPropagation","",1,"c-btn",3,"click"],[1,"l-otp__text"],[4,"ngIf","ngIfElse"],["type","tel","autocomplete","off","maxlength","1",1,"o-inputbox","o-inputbox--otp",3,"input","keydown","formControlName"],["href","#","appStopPropagation","",3,"click"]],template:function(t,e){if(t&1){let o=v();r(0,"div",2)(1,"div",3)(2,"div",4),a(3,"\u96FB\u5B50\u90F5\u4EF6OTP\u9A57\u8B49"),p()(),r(4,"div",5)(5,"div",6)(6,"div",7),a(7," \u5DF2\u5C07\u9A57\u8B49\u78BC\u767C\u9001\u5230\u60A8\u7684E-mail"),w(8,"br"),r(9,"span",8),a(10),p()(),r(11,"div",9),a(12,"\u8ACB\u8F38\u5165OTP\u9A57\u8B49\u78BC"),p(),r(13,"div",10),E(14,et,2,1,"input",11),p(),r(15,"div",12)(16,"div",13)(17,"a",14),C("click",function(){return u(o),m(e.submitOtp())}),a(18," \u78BA\u8A8D "),p()()(),r(19,"div",15),E(20,it,2,1,"ng-container",16)(21,ot,2,0,"ng-template",null,0,R),p()()()()}if(t&2){let o=k(22);l(4),_("formGroup",e.otpForm),l(6),D(e.maskEmail),l(4),_("ngForOf",e.otpInputArray.controls),l(6),_("ngIf",e.second>0)("ngIfElse",o)}},dependencies:[P,M,G,Y,U,H,q,W,K,J,z,Z]})};export{$ as a};
