import{a as y}from"./chunk-I4Z6E5RZ.js";import{b as N,c as g,d as z,e as V,h as q,j as H,o as O,p as W,q as Z}from"./chunk-3LHWI2W3.js";import{a as S}from"./chunk-IX7WFBWE.js";import{a as d}from"./chunk-OTP24YHY.js";import{v as f}from"./chunk-2F6OI5QL.js";import{a as Y}from"./chunk-AN255T3T.js";import{a as J,b as K,e as Q,h as X}from"./chunk-FBP2EEXM.js";import{g as v,h as M,l as P}from"./chunk-Q7SBYYKA.js";import{a as $}from"./chunk-AN7I7KN4.js";import{c as _}from"./chunk-7ABVTXG4.js";import"./chunk-4QTMHVTB.js";import{$a as l,Ab as k,Ac as U,Bb as I,Ec as D,Jb as c,Rb as T,Sb as A,Tb as j,aa as L,ab as s,da as R,fa as p,ma as x,nb as u,q as B,qb as a,rb as F,sb as r,tb as n,ub as m,vb as w,wb as E,xc as G}from"./chunk-K24PMR7C.js";import{g as b}from"./chunk-TSRGIXR5.js";var se=new R("google",{providedIn:"root",factory:()=>{if(!window.google)throw new Error("Google script not loaded!");return window.google}}),h=class i{constructor(o,e,t,C,ie,te){this.userRepositoryService=o;this.cookieService=e;this.userStoreService=t;this.router=C;this.sweetAlertService=ie;this.google=te}clientId="194845046746-ind8shn8n3c52pjiishd4gbelkq379pe.apps.googleusercontent.com";loadGoogleAuth(){this.google.accounts.id.initialize({client_id:this.clientId,callback:this.handleResponse.bind(this),auto_select:!1});let o=document.getElementById("googleSign");this.google.accounts.id.renderButton(o,{theme:"outline",size:"large"})}handleResponse(o){let e=o.credential;if(!e){this.sweetAlertService.open(d,{icon:"error",data:{text:"\u767B\u5165\u5931\u6557"}});return}this.userRepositoryService.postGoogleLogin({googleToken:e}).subscribe(t=>{t.result.accessToken?(this.cookieService.set("accessToken",t.result.accessToken,60),this.userStoreService.setUserIsLogin(!0),this.router.navigate(["/"])):this.sweetAlertService.open(d,{icon:"error",data:{text:"\u767B\u5165\u5931\u6557"}})})}static \u0275fac=function(e){return new(e||i)(p(S),p(y),p(f),p(v),p(_),p(se))};static \u0275prov=L({token:i,factory:i.\u0275fac,providedIn:"root"})};var pe=i=>({"background-image":i}),ue=()=>["/forgetPassword"],de=()=>["/register"];function ge(i,o){i&1&&(r(0,"div",28),c(1," \u8ACB\u8F38\u5165\u4FE1\u7BB1 "),n())}function ve(i,o){i&1&&(r(0,"div",28),c(1," \u8ACB\u8F38\u5165\u6B63\u78BAemail\u683C\u5F0F "),n())}function fe(i,o){if(i&1&&(w(0),u(1,ge,2,0,"div",27)(2,ve,2,0,"div",27),E()),i&2){let e=I();l(),a("ngIf",e.loginForm.controls.email.hasError("required")&&e.loginForm.controls.email.dirty),l(),a("ngIf",e.loginForm.controls.email.hasError("pattern")&&e.loginForm.controls.email.dirty)}}function Se(i,o){i&1&&(r(0,"div",28),c(1," \u8ACB\u8F38\u5165\u5BC6\u78BC "),n())}function _e(i,o){i&1&&(r(0,"div",28),c(1," \u5BC6\u78BC\u9577\u5EA6\u9700\u5927\u65BC8\u78BC "),n())}function ye(i,o){if(i&1&&(w(0),u(1,Se,2,0,"div",27)(2,_e,2,0,"div",27),E()),i&2){let e=I();l(),a("ngIf",e.loginForm.controls.password.hasError("required")&&e.loginForm.controls.password.dirty),l(),a("ngIf",e.loginForm.controls.password.hasError("minlength")&&e.loginForm.controls.password.dirty)}}var ee=class i{constructor(o,e,t,C,ie,te,he,Ce){this.fb=o;this.router=e;this.userRepositoryService=t;this.tmdbRepositoryService=C;this.userStoreService=ie;this.cookieService=te;this.sweetAlertService=he;this.googleLoginService=Ce;this.loginForm=this.fb.group({email:["",[g.required,g.pattern("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$")]],password:["",[g.required,g.minLength(8)]]})}loginForm;faEye=X;faEyeSlash=Q;isHiddenEye=!0;bgPic="";ngOnInit(){return b(this,null,function*(){let o=yield this.getMovieDetail();this.bgPic=o.backdrop_path})}ngAfterViewInit(){this.googleLoginService.loadGoogleAuth()}getMovieDetail(){return b(this,null,function*(){let o={language:"zh-TW"};return yield B(this.tmdbRepositoryService.getMovieDetail("1104845",o))})}toggleEye(){this.isHiddenEye=!this.isHiddenEye}login(){if(this.loginForm.valid===!0){let o=this.loginForm.getRawValue(),e={email:o.email,password:o.password};this.userRepositoryService.postLogin(e).subscribe(t=>{t.result.accessToken?(this.cookieService.set("accessToken",t.result.accessToken,60),this.userStoreService.setUserIsLogin(!0),this.router.navigate(["/"])):this.sweetAlertService.open(d,{icon:"error",data:{text:"\u767B\u5165\u5931\u6557"}})})}}static \u0275fac=function(e){return new(e||i)(s(O),s(v),s(S),s(Y),s(f),s(y),s(_),s(h))};static \u0275cmp=x({type:i,selectors:[["app-login"]],standalone:!0,features:[T],decls:40,vars:17,consts:[[1,"l-login",3,"ngStyle"],[1,"l-login__content"],[1,"l-login__item"],[1,"l-form"],[1,"l-form__title","l-form__title--login"],[1,"u-font-lg"],[1,"l-form__content"],[1,"c-form","c-form--column",3,"formGroup"],[1,"c-form__item","c-form__item--column"],[1,"c-form__text"],["type","text","formControlName","email","placeholder","\u8ACB\u8F38\u5165\u4FE1\u7BB1",1,"o-inputbox","o-inputbox--full"],[4,"ngIf"],[1,"c-login__input"],["formControlName","password","placeholder","\u8ACB\u8F38\u5165\u5BC6\u78BC",1,"o-inputbox","o-inputbox--full","o-inputbox--icon",3,"type"],["href","#","appStopPropagation","",1,"c-login__eye",3,"click"],[1,"u-font-gy",3,"icon","size"],[1,"l-btn","l-btn--center","u-gapB-sm"],[1,"l-btn__item","l-btn__item--full"],["href","#","appStopPropagation","",1,"c-btn",3,"click"],[1,"o-link","u-font-min",3,"routerLink"],[1,"l-login__line"],[1,"c-login__line"],[1,"l-login__third"],[1,"l-btn","l-btn--noWrap","l-btn--center","u-gapB-sm"],["id","googleSign",1,"l-btn__item","l-btn__item--center"],[1,"l-login__register"],[1,"o-link",3,"routerLink"],["class","c-form__error",4,"ngIf"],[1,"c-form__error"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"div",1),m(2,"div"),r(3,"div",2)(4,"div",3)(5,"div",4)(6,"span",5),c(7,"\u767B\u5165"),n()(),r(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9),m(12,"input",10),n(),u(13,fe,3,2,"ng-container",11),n(),r(14,"div",8)(15,"div",9)(16,"div",12),m(17,"input",13),r(18,"a",14),k("click",function(){return t.toggleEye()}),m(19,"fa-icon",15),n()()(),u(20,ye,3,2,"ng-container",11),n()(),r(21,"div",16)(22,"div",17)(23,"a",18),k("click",function(){return t.login()}),c(24," \u767B\u5165 "),n()()(),r(25,"div")(26,"a",19),c(27," \u5FD8\u8A18\u5BC6\u78BC? "),n()(),r(28,"div",20),m(29,"div",21),r(30,"span"),c(31,"\u6216"),n(),m(32,"div",21),n(),r(33,"div",22)(34,"div",23),m(35,"div",24),n()(),r(36,"div",25),c(37," \u6C92\u6709\u5E33\u865F? "),r(38,"a",26),c(39," \u8A3B\u518A "),n()()()()()()()),e&2&&(a("ngStyle",j(13,pe,"url(https://image.tmdb.org/t/p/original"+t.bgPic+")")),l(9),a("formGroup",t.loginForm),l(3),F("is-error",t.loginForm.controls.email.invalid&&t.loginForm.controls.email.dirty),l(),a("ngIf",t.loginForm.controls.email.dirty),l(4),F("is-error",t.loginForm.controls.password.invalid&&t.loginForm.controls.password.dirty),a("type",t.isHiddenEye?"password":"text"),l(2),a("icon",t.isHiddenEye?t.faEyeSlash:t.faEye)("size","lg"),l(),a("ngIf",t.loginForm.controls.password.dirty),l(6),a("routerLink",A(15,ue)),l(12),a("routerLink",A(16,de)))},dependencies:[D,G,U,W,N,z,V,Z,q,H,P,M,K,J,$]})};export{ee as LoginComponent};
